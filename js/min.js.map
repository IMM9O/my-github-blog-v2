{"version":3,"file":"min.js","sources":["../src/main.js"],"sourcesContent":["/**\r\n * Copyright (c) 2020 Google Inc\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\r\n * this software and associated documentation files (the \"Software\"), to deal in\r\n * the Software without restriction, including without limitation the rights to\r\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of\r\n * the Software, and to permit persons to whom the Software is furnished to do so,\r\n * subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in all\r\n * copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS\r\n * FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR\r\n * COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER\r\n * IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN\r\n * CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\r\n */\r\n\r\nconst exposed = {};\r\nif (location.search) {\r\n  var a = document.createElement(\"a\");\r\n  a.href = location.href;\r\n  a.search = \"\";\r\n  history.replaceState(null, null, a.href);\r\n}\r\n\r\nfunction tweet_(url) {\r\n  open(\r\n    \"https://twitter.com/intent/tweet?url=\" + encodeURIComponent(url),\r\n    \"_blank\"\r\n  );\r\n}\r\nfunction tweet(anchor) {\r\n  tweet_(anchor.getAttribute(\"href\"));\r\n}\r\nexpose(\"tweet\", tweet);\r\n\r\nfunction share(anchor) {\r\n  var url = anchor.getAttribute(\"href\");\r\n  event.preventDefault();\r\n  if (navigator.share) {\r\n    navigator.share({\r\n      url: url,\r\n    });\r\n  } else if (navigator.clipboard) {\r\n    navigator.clipboard.writeText(url);\r\n    message(\"Article URL copied to clipboard.\");\r\n  } else {\r\n    tweet_(url);\r\n  }\r\n}\r\nexpose(\"share\", share);\r\n\r\nfunction message(msg) {\r\n  var dialog = document.getElementById(\"message\");\r\n  dialog.textContent = msg;\r\n  dialog.setAttribute(\"open\", \"\");\r\n  setTimeout(function () {\r\n    dialog.removeAttribute(\"open\");\r\n  }, 3000);\r\n}\r\n\r\nfunction prefetch(e) {\r\n  if (e.target.tagName != \"A\") {\r\n    return;\r\n  }\r\n  if (e.target.origin != location.origin) {\r\n    return;\r\n  }\r\n  var l = document.createElement(\"link\");\r\n  l.rel = \"prefetch\";\r\n  l.href = e.target.href;\r\n  document.head.appendChild(l);\r\n}\r\ndocument.documentElement.addEventListener(\"mouseover\", prefetch, {\r\n  capture: true,\r\n  passive: true,\r\n});\r\ndocument.documentElement.addEventListener(\"touchstart\", prefetch, {\r\n  capture: true,\r\n  passive: true,\r\n});\r\n\r\nconst GA_ID = document.documentElement.getAttribute(\"ga-id\");\r\nwindow.ga =\r\n  window.ga ||\r\n  function () {\r\n    if (!GA_ID) {\r\n      return;\r\n    }\r\n    (ga.q = ga.q || []).push(arguments);\r\n  };\r\nga.l = +new Date();\r\nga(\"create\", GA_ID, \"auto\");\r\nga(\"set\", \"transport\", \"beacon\");\r\nvar timeout = setTimeout(\r\n  (onload = function () {\r\n    clearTimeout(timeout);\r\n    ga(\"send\", \"pageview\");\r\n  }),\r\n  1000\r\n);\r\n\r\nvar ref = +new Date();\r\nfunction ping(event) {\r\n  var now = +new Date();\r\n  if (now - ref < 1000) {\r\n    return;\r\n  }\r\n  ga(\"send\", {\r\n    hitType: \"event\",\r\n    eventCategory: \"page\",\r\n    eventAction: event.type,\r\n    eventLabel: Math.round((now - ref) / 1000),\r\n  });\r\n  ref = now;\r\n}\r\naddEventListener(\"pagehide\", ping);\r\naddEventListener(\"visibilitychange\", ping);\r\naddEventListener(\r\n  \"click\",\r\n  function (e) {\r\n    var button = e.target.closest(\"button\");\r\n    if (!button) {\r\n      return;\r\n    }\r\n    ga(\"send\", {\r\n      hitType: \"event\",\r\n      eventCategory: \"button\",\r\n      eventAction: button.getAttribute(\"aria-label\") || button.textContent,\r\n    });\r\n  },\r\n  true\r\n);\r\nvar selectionTimeout;\r\naddEventListener(\r\n  \"selectionchange\",\r\n  function () {\r\n    clearTimeout(selectionTimeout);\r\n    var text = String(document.getSelection()).trim();\r\n    if (text.split(/[\\s\\n\\r]+/).length < 3) {\r\n      return;\r\n    }\r\n    selectionTimeout = setTimeout(function () {\r\n      ga(\"send\", {\r\n        hitType: \"event\",\r\n        eventCategory: \"selection\",\r\n        eventAction: text,\r\n      });\r\n    }, 2000);\r\n  },\r\n  true\r\n);\r\n\r\nif (window.ResizeObserver && document.querySelector(\"header nav #nav\")) {\r\n  var progress = document.getElementById(\"reading-progress\");\r\n\r\n  var timeOfLastScroll = 0;\r\n  var requestedAniFrame = false;\r\n  function scroll() {\r\n    if (!requestedAniFrame) {\r\n      requestAnimationFrame(updateProgress);\r\n      requestedAniFrame = true;\r\n    }\r\n    timeOfLastScroll = Date.now();\r\n  }\r\n  addEventListener(\"scroll\", scroll);\r\n\r\n  var winHeight = 1000;\r\n  var bottom = 10000;\r\n  function updateProgress() {\r\n    requestedAniFrame = false;\r\n    var percent = Math.min(\r\n      (document.scrollingElement.scrollTop / (bottom - winHeight)) * 100,\r\n      100\r\n    );\r\n    progress.style.transform = `translate(-${100 - percent}vw, 0)`;\r\n    if (Date.now() - timeOfLastScroll < 3000) {\r\n      requestAnimationFrame(updateProgress);\r\n      requestedAniFrame = true;\r\n    }\r\n  }\r\n\r\n  new ResizeObserver(() => {\r\n    bottom =\r\n      document.scrollingElement.scrollTop +\r\n      document.querySelector(\"#comments,footer\").getBoundingClientRect().top;\r\n    winHeight = window.innerHeight;\r\n    scroll();\r\n  }).observe(document.body);\r\n}\r\n\r\nfunction expose(name, fn) {\r\n  exposed[name] = fn;\r\n}\r\n\r\naddEventListener(\"click\", (e) => {\r\n  const handler = e.target.closest(\"[on-click]\");\r\n  if (!handler) {\r\n    return;\r\n  }\r\n  e.preventDefault();\r\n  const name = handler.getAttribute(\"on-click\");\r\n  const fn = exposed[name];\r\n  if (!fn) {\r\n    throw new Error(\"Unknown handler\" + name);\r\n  }\r\n  fn(handler);\r\n});\r\n\r\n// There is a race condition here if an image loads faster than this JS file. But\r\n// - that is unlikely\r\n// - it only means potentially more costly layouts for that image.\r\n// - And so it isn't worth the querySelectorAll it would cost to synchronously check\r\n//   load state.\r\ndocument.body.addEventListener(\r\n  \"load\",\r\n  (e) => {\r\n    if (e.target.tagName != \"IMG\") {\r\n      return;\r\n    }\r\n    // Ensure the browser doesn't try to draw the placeholder when the real image is present.\r\n    e.target.style.backgroundImage = \"none\";\r\n  },\r\n  /* capture */ \"true\"\r\n);\r\n"],"names":["exposed","location","search","a","document","createElement","href","history","replaceState","tweet_","url","open","encodeURIComponent","prefetch","e","target","tagName","origin","l","rel","head","appendChild","expose","anchor","getAttribute","msg","dialog","event","preventDefault","navigator","share","clipboard","writeText","getElementById","textContent","setAttribute","setTimeout","removeAttribute","documentElement","addEventListener","capture","passive","GA_ID","window","ga","q","push","arguments","Date","selectionTimeout","timeout","onload","clearTimeout","ref","ping","now","hitType","eventCategory","eventAction","type","eventLabel","Math","round","button","closest","text","String","getSelection","trim","split","length","ResizeObserver","querySelector","progress","timeOfLastScroll","requestedAniFrame","scroll","requestAnimationFrame","updateProgress","winHeight","bottom","percent","min","scrollingElement","scrollTop","style","transform","getBoundingClientRect","top","innerHeight","observe","body","name","fn","handler","Error","backgroundImage"],"mappings":"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"}